<div class="row border-bottom white-bg page-heading">
  <div class="col-lg-8">
    <h2>
      Page d'administration
    </h2>
    <ol class="breadcrumb">
      <li>
        <a ui-sref="index.sales">Accueil</a>
      </li>
      <li class="active">
        <strong>Administration</strong>
      </li>
    </ol>
  </div>
  <div class="col-lg-4">
    <div class="title-action">
      <!--<button type="button" class="btn btn-primary btn-outline" ng-click="vm.getFirebaseImages()">Récupérer images firebase vers Vend</button>-->
    </div>
  </div>
</div>
<div class="wrapper-content animated fadeInRight">
  <div class="row">
    <div class="col-lg-12">
      <uib-tabset>
        <uib-tab heading="Utilisateurs MyBoxCorner">
          <div class="panel-body ibox-content">
            <div class="table-responsive">
              <!--<table datatable="ng" dt-options="vm.dtOptions" class="row-border hover">-->
              <table datatable="ng" dt-options="vm.dtOptions" dt-column-defs="vm.dtColumnDefs" class="table table-striped table-bordered table-hover dataTables-example">
                <thead>
                  <tr>
                    <th>Nom</th>
                    <th>Prénom</th>
                    <th>Société</th>
                    <th>Email</th>
                    <th>Nb produits à envoyer</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr ng-repeat="user in vm.users">
                    <td>{{ ::user.lastname }}</td>
                    <td>{{ ::user.firstname }}</td>
                    <td>{{ ::user.company }}</td>
                    <td>{{ ::user.email }}</td>
                    <td>{{ ::user.totalToSend }}</td>
                    <td class="text-right">
                      <div class="btn-group">
                        <button class="btn-white btn btn-xs" ui-sref="index.admin-user({id: user.$id})">Détails</button>
                        <button class="btn-white btn btn-xs" ng-click="vm.getCustomerOrders(user)">Récup commandes</button>
                        <button class="btn-white btn btn-xs" ng-click="vm.resetPassword(user.$id)">Reset pwd</button>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </uib-tab>
        <uib-tab heading="Utilisateurs WooCommerce">
          <div class="panel-body ibox-content">
            <div class="table-responsive">
              <table datatable="ng" dt-options="vm.dtOptions" dt-column-defs="vm.dtColumnDefs" class="table table-striped table-bordered table-hover dataTables-example">
                <thead>
                  <tr>
                    <th>Nom</th>
                    <th>Prénom</th>
                    <th>Société</th>
                    <th>Email</th>
                    <th>Nb Commande</th>
                    <th>Role</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr ng-repeat="customer in vm.customers">
                    <td>{{ ::customer.last_name }}</td>
                    <td>{{ ::customer.first_name }}</td>
                    <td>{{ ::customer.billing_address.company }}</td>
                    <td>{{ ::customer.email }}</td>
                    <td>{{ ::customer.orders_count }}</td>
                    <td>
                      <span class="label label-primary">{{ ::customer.role }}</span>
                    </td>
                    <td class="text-right">
                      <div class="btn-group">
                        <button class="btn-white btn btn-xs" ng-click="vm.createAccount(customer)">Créer compte</button>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </uib-tab>
        <uib-tab heading="Transferts de stock">
          <div class="panel-body ibox-content">
            <table class="footable table table-stripped toggle-arrow-tiny" data-page-size="5">
              <thead>
                <tr>
                  <th data-toggle="true">Nom</th>
                  <th data-hide="phone">Date</th>
                  <th data-hide="phone">Statut</th>
                  <th data-hide="phone">Source</th>
                  <th data-hide="phone">Destination</th>
                  <th data-hide="all"></th>
                  <th class="text-right" data-sort-ignore="true">Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr ng-repeat="st in vm.stockTransfers track by $index">
                  <td>{{st.name}}</td>
                  <td>{{st.date}}</td>
                  <td>{{st.status}}</td>
                  <td>{{st.source_outlet_id}}</td>
                  <td>{{st.outlet_id}}</td>
                  <td>
                    <table class="footable table">
                      <thead>
                        <tr>
                          <th data-toggle="true">Nom produit</th>
                          <th>Nb envoyé</th>
                          <th>Nb reçu</th>
                          <th>Valeur</th>
                        </tr>
                      </thead>
                      <tr ng-repeat="product in st.products">
                        <td>{{product.name}}</td>
                        <td>{{product.count | number}}</td>
                        <td>{{product.received}}</td>
                        <td>{{product.cost | number:2}}</td>
                      </tr>
                    </table>
                  </td>
                  <td>
                    <div class="title-action">
                      <button class="btn btn-primary btn-rounded" ng-click="vm.markAsSent(st.id, $index)">Marquer comme envoyé</button>
                      <button class="btn btn-primary btn-rounded" ng-click="vm.exportStockTransfert(st.id)">Export .DAT</button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </uib-tab>
        <uib-tab heading="Reversements">
          <div class="panel-body ibox-content">
            <div class="row">
              <div class="col-lg-8 col-md-12">
                <div class="col-sm-4">
                  <div class="form-group">
                    <label class="control-label">Magasins</label>
                    <ui-select ng-model="vm.filter.outlet" title="Magasins">
                      <ui-select-match allow-clear="true" placeholder="Sélectionner un magasin">{{$select.selected.name}}</ui-select-match>
                      <ui-select-choices repeat="outlet.name as outlet in vm.outlets | filter: $select.search | orderBy: 'name'">
                        <div ng-bind-html="outlet.name | highlight: $select.search"></div>
                      </ui-select-choices>
                    </ui-select>
                  </div>
                </div>
                <div class="col-sm-4">
                  <div class="form-group">
                    <label class="control-label">Marques</label>
                    <ui-select ng-model="vm.filter.supplier" title="Marques">
                      <ui-select-match allow-clear="true" placeholder="Sélectionner une marque">{{$select.selected.name}}</ui-select-match>
                      <ui-select-choices repeat="supplier.name as supplier in vm.suppliers | filter: $select.search | orderBy: 'name'">
                        <div ng-bind-html="supplier.name | highlight: $select.search"></div>
                      </ui-select-choices>
                    </ui-select>
                  </div>
                </div>
                <div class="col-sm-4">
                  <div class="form-group">
                    <label class="control-label">Recherche</label>
                    <input type="text" id="recherche" name="recherche" ng-model="vm.filter.search" placeholder="Saisir une recherche" class="form-control">
                  </div>
                </div>
              </div>
              <div class="col-lg-4 col-md-12">
                <div class="col-sm-4">
                  <div class="form-group">
                    <label class="control-label">Mois</label>
                    <ui-select ng-model="vm.filter.month" title="Marques">
                      <ui-select-match allow-clear="true" placeholder="Mois">{{$select.selected.$value}}</ui-select-match>
                      <ui-select-choices repeat="month.$id as month in vm.months">
                        <div ng-bind-html="month.$value"></div>
                      </ui-select-choices>
                    </ui-select>
                  </div>
                </div>
                <div class="col-sm-4 title-action">
                  <button class="btn btn-primary" ng-click="vm.generateBills(vm.filter.month)">Générer les factures</button>
                </div>
                <div class="col-sm-4 title-action">
                  <button class="btn btn-primary btn-outline" ng-click="vm.generateXML()">Générer le XML</button>
                </div>
              </div>
            </div>
            <div class="panel-body" ng-if="vm.loading">
              <div class="sk-spinner sk-spinner-three-bounce">
                <div class="sk-bounce1"></div>
                <div class="sk-bounce2"></div>
                <div class="sk-bounce3"></div>
              </div>
            </div>
            <div class="table-responsive">
              <table class="footable table table-stripped toggle-arrow-tiny" data-page-size="20">
                <thead>
                  <tr>
                    <th data-sort-ignore="true"></th>
                    <th data-toggle="true" data-sort-initial="true">Numéro</th>
                    <th data-hide="phone">Marque</th>
                    <th data-hide="phone">Magasin</th>
                    <th data-hide="phone">Total HT</th>
                    <th data-hide="phone">TVA</th>
                    <th data-hide="phone">Total TTC</th>
                    <th data-hide="phone">Taux Comission</th>
                    <th data-hide="phone">Comission</th>
                    <th data-hide="phone">Net à payer</th>
                    <th data-hide="phone">Statut</th>
                    <th class="text-right" data-sort-ignore="true">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr ng-repeat="payment in vm.payments | filter: vm.filter.search" ng-click="payment.checked = !payment.checked">
                    <td><input class="checkbox" type="checkbox" ng-model="payment.checked"></td>
                    <td>{{::payment.number}}</td>
                    <td>{{::payment.company}}</td>
                    <td>{{::payment.outletName}}</td>
                    <td>{{::payment.totalHT | currency}}</td>
                    <td>{{::payment.totalTTC - payment.totalHT | currency}}</td>
                    <td>{{::payment.totalTTC | currency}}</td>
                    <td>{{::payment.tauxDeCommission}}%</td>
                    <td>- {{::payment.totalCom | currency}}</td>
                    <td><span class="label label-info">{{::payment.totalToPay | currency}}</span></td>
                    <td>
                      <span class="label" ng-class="payment.status === 'A payer' ? 'label-primary' : 'label-success'">{{payment.status}}</span>
                    </td>
                    <td>
                      <div class="text-right">
                        <a class="btn btn-primary" ui-sref="print-payment({id:payment.number})" target="_blank"><i class="fa fa-print" aria-hidden="true"></i> Imprimer</a>
                        <!--<button ng-if="payment.status === 'A payer'" class="btn btn-primary btn-outline" ng-click="vm.makePayment(payment)"><i class="fa fa-dollar"></i> Payer</button>-->
                      </div>
                    </td>
                  </tr>
                </tbody>
                <tfoot>
                  <tr>
                     <td colspan="10" align="right">
                      <ul class="pagination hide-if-no-paging"></ul>
                    </td>
                    <td colspan="3" align="right">
                      <div class="title-action">
                        <span>Total des commissions : {{vm.totalPaymentsCommission | currency}}</span>
                      </div>
                    </td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>
        </uib-tab>
        <uib-tab heading="Factures">
          <div class="panel-body ibox-content">
            <div class="row">
              <div class="col-sm-8">
                <div class="col-sm-4">
                  <div class="form-group">
                    <label class="control-label">Magasins</label>
                    <ui-select ng-model="vm.filter.outlet" title="Magasins">
                      <ui-select-match allow-clear="true" placeholder="Sélectionner un magasin">{{$select.selected.name}}</ui-select-match>
                      <ui-select-choices repeat="outlet.name as outlet in vm.outlets | filter: $select.search | orderBy: 'name'">
                        <div ng-bind-html="outlet.name | highlight: $select.search"></div>
                      </ui-select-choices>
                    </ui-select>
                  </div>
                </div>
                <div class="col-sm-4">
                  <div class="form-group">
                    <label class="control-label">Marques</label>
                    <ui-select ng-model="vm.filter.supplier" title="Marques">
                      <ui-select-match allow-clear="true" placeholder="Sélectionner une marque">{{$select.selected.name}}</ui-select-match>
                      <ui-select-choices repeat="supplier.name as supplier in vm.suppliers | filter: $select.search | orderBy: 'name'">
                        <div ng-bind-html="supplier.name | highlight: $select.search"></div>
                      </ui-select-choices>
                    </ui-select>
                  </div>
                </div>
                <div class="col-sm-4">
                  <div class="form-group">
                    <label class="control-label">Recherche</label>
                    <input type="text" id="recherche" name="recherche" ng-model="vm.filter.search" placeholder="Saisir une recherche" class="form-control">
                  </div>
                </div>
              </div>
              <div class="col-sm-4">
                <div class="col-sm-4">
                  <div class="form-group">
                    <label class="control-label">Mois</label>
                    <ui-select ng-model="vm.filter.month" title="Marques">
                      <ui-select-match allow-clear="true" placeholder="Mois">{{$select.selected.$value}}</ui-select-match>
                      <ui-select-choices repeat="month.$id as month in vm.months">
                        <div ng-bind-html="month.$value"></div>
                      </ui-select-choices>
                    </ui-select>
                  </div>
                </div>
                <!--<div class="col-sm-4 title-action">
                  <button class="btn btn-primary" ng-click="vm.generateBills(vm.filter.month)">Générer les factures</button>
                </div>
                <div class="col-sm-4 title-action" >
                  <button class="btn btn-primary" ng-click="vm.generateXML()">Générer le XML</button>
                </div>-->
              </div>
            </div>
            <div class="panel-body" ng-if="vm.loading">
              <div class="sk-spinner sk-spinner-three-bounce">
                <div class="sk-bounce1"></div>
                <div class="sk-bounce2"></div>
                <div class="sk-bounce3"></div>
              </div>
            </div>
            <div class="table-responsive">
              <table class="footable table table-stripped toggle-arrow-tiny" data-page-size="20">
                <thead>
                  <tr>
                    <th data-sort-ignore="true"></th>
                    <th data-toggle="true" data-sort-initial="true">Numéro</th>
                    <th data-hide="phone">Marque</th>
                    <th data-hide="phone">Magasin</th>
                    <th data-hide="phone">Total HT</th>
                    <th data-hide="phone">TVA</th>
                    <th data-hide="phone">Total TTC</th>
                    <th data-hide="phone">Taux Comission</th>
                    <th data-hide="phone">Total payé</th>
                    <th data-hide="phone">Comission</th>
                    <th data-hide="phone">Statut</th>
                    <th class="text-right" data-sort-ignore="true">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr ng-repeat="bill in vm.bills | filter: vm.filter.search ">
                    <td><input class="checkbox" type="checkbox" ng-model="bill.checked"></td>
                    <td>{{::bill.number}}</td>
                    <td>{{::bill.company}}</td>
                    <td>{{::bill.outletName}}</td>
                    <td>{{::bill.totalHT | currency}}</td>
                    <td>{{::bill.totalTTC - bill.totalHT | currency}}</td>
                    <td>{{::bill.totalTTC | currency}}</td>
                    <td>{{::bill.tauxDeCommission}}%</td>
                    <td>- {{::bill.totalToPay | currency}}</td>
                    <td><span class="label label-info">{{::bill.totalCom | currency}}</span></td>
                    <td>
                      <span class="label" ng-class="bill.status === 'A payer' ? 'label-primary' : 'label-success'">{{bill.status}}</span>
                    </td>
                    <td>
                      <div class="text-right">
                        <a class="btn btn-primary" ui-sref="print-bill({id:bill.number})" target="_blank"><i class="fa fa-print" aria-hidden="true"></i> Imprimer</a>
                        <button ng-if="bill.status === 'A payer'" class="btn btn-primary btn-outline" ng-click="vm.paymentDone(bill)"><i class="fa fa-dollar"></i> Payer</button>
                      </div>
                    </td>
                  </tr>
                </tbody>
                <tfoot>
                  <tr>
                    <td colspan="10" align="right">
                      <ul class="pagination hide-if-no-paging"></ul>
                    </td>
                    <td colspan="2" align="right">
                      <div class="title-action">
                        <span>Total des commissions : {{vm.totalBillsCommission | currency}}</span>
                      </div>
                    </td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>
        </uib-tab>
      </uib-tabset>
    </div>
  </div>
</div>
